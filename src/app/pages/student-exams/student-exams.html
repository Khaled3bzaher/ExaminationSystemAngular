<p-toast
  [breakpoints]="{ '920px': { width: '100%', right: '0', left: '0' } }"
/>

@if(isLoading){
<div class="card flex justify-center">
  <p-progress-spinner
    strokeWidth="8"
    fill="transparent"
    animationDuration=".5s"
    [style]="{ width: '50px', height: '50px' }"
  />
</div>
}@else {
<div class="p-20">
  @if(!examStarted && !examSubmitted){
  <div class="p-6 space-y-6">
    <app-exam-instruction (accepted)="startExam()" [examName]="subjectName"></app-exam-instruction>
  </div>
  } @if(examStarted && !examSubmitted){
  <div class="space-y-6">
    <div
      class="flex justify-between items-center p-4 bg-gray-100 rounded shadow"
    >
      <span class="text-lg font-bold text-indigo-700"
        >Remaining Time: {{ timeLeft }}</span
      >


      <p-button
        label="Submit"
        icon="pi pi-check"
        severity="danger"
        (onClick)="submitExam()"
      />
    </div>

        <p-progressbar [value]="progressValue"   showValue="false" />

    <app-exam-question
      [question]="exam.questions[currentPage]"
      [selectedChoiceId]="answers[exam.questions[currentPage].id]"
      (answered)="storeAnswer($event.questionId, $event.selectedChoiceId)"
    >
    </app-exam-question>
<div class="flex justify-between items-center pt-4">
  <p-button
    label="Previous"
    icon="pi pi-arrow-left"
    (onClick)="prevQuestion()"
    [disabled]="currentPage === 0"
    severity="secondary"
    class="w-32"
  />

  <span class="text-sm text-gray-500">
    Question {{ currentPage + 1 }} of {{ exam.questions.length }}
  </span>

  @if(currentPage === exam.questions.length - 1) {
    <p-button
      label="Finish Exam"
      icon="pi pi-check"
      severity="danger"
      (onClick)="submitExam()"
      class="w-40"
    />
  } @else {
    <p-button
      label="Next"
      iconPos="right"
      icon="pi pi-arrow-right"
      (onClick)="nextQuestion()"
      severity="primary"
      class="w-32"
    />
  }
</div>
    <div class="flex flex-wrap gap-2 justify-center pt-6">
      @for (q of exam.questions; track $index) {
      <p-button
        [label]="isAnswered(q.id) ? ($index + 1).toString() + '- Answerd' : ($index + 1).toString() + '- Draft'"
        [severity]="isAnswered(q.id) ? 'success' : 'secondary'"
        (onClick)="goToPage($index)"
        size="small"
      >
      </p-button>
    }
    </div>
  </div>

  } @if(examSubmitted) {
    <div class="bg-white rounded-3xl shadow-xl border border-green-200 p-8 text-center">
      <i class="pi pi-check-circle text-green-500 text-6xl mb-4"></i>
      <h3 class="text-2xl font-bold text-green-700 mb-2">Exam Submitted Successfully!</h3>
      <p class="text-gray-600 mb-6">Your answers have been recorded.</p>
      <p-button
        label="Back to Exams"
        icon="pi pi-history"
        severity="success"
        routerLink="/exams"
        class="px-6"
      ></p-button>
    </div>
    }
</div>
}
  <p-confirmDialog [style]="{ width: '450px' }" class="rounded-md" />

